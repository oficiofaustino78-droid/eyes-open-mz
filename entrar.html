<!DOCTYPE html>
<html lang="pt-MZ">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eyes Open MZ - Entrar</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@400;600&display=swap" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Rajdhani', sans-serif; }
    body, html { height: 100%; overflow: hidden; background: #0a0a1a; color: #fff; }
    .map-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
      background: url('Mozimagem1.jpg') center/contain no-repeat; opacity: 0.15; pointer-events: none; }

    .container { position: relative; z-index: 2; min-height: 100vh; display: flex; flex-direction: column;
      justify-content: center; align-items: center; padding: 2rem; }

    .logo-container { display: flex; flex-direction: column; align-items: center; margin-bottom: 2rem; }
    .logo-container img { width: 140px; height: 140px; border-radius: 50%; animation: float 5s ease-in-out infinite;
      box-shadow: 0 0 25px #00f5ff; }
    @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-15px);} }

    .logo { font-family: 'Orbitron', sans-serif; font-size: 3.5rem;
      background: linear-gradient(90deg, #00f5ff, #ff00ff, #00ffdd); -webkit-background-clip: text; color: transparent;
      text-shadow: 0 0 15px rgba(0,255,255,.7); animation: glow 2s ease-in-out infinite alternate; }
    @keyframes glow { 0% { text-shadow: 0 0 15px rgba(0,255,255,.7); } 100% { text-shadow: 0 0 25px rgba(0,255,255,.9); } }

    .tagline { font-size: 1.2rem; opacity: .9; margin-bottom: 1.5rem; }

    .box { background: rgba(255,255,255,.08); backdrop-filter: blur(12px);
      border: 1px solid rgba(0,255,255,.3); border-radius: 1.5rem; padding: 2.5rem 2rem; width: 100%; max-width: 380px;
      box-shadow: 0 8px 32px rgba(0,0,0,.4); }

    .input-group { position: relative; margin-bottom: 1.5rem; }
    .input-group input { width: 100%; padding: 1rem 1rem 1rem 2.5rem; background: rgba(255,255,255,.05);
      border: 1px solid rgba(0,255,255,.3); border-radius: .75rem; color: #fff; font-size: 1rem; }
    .input-group input:focus { border-color: #00f5ff; outline: none; }
    .input-group i { position: absolute; left: 1rem; top: 1rem; color: #00f5ff; }

    .btn { width: 100%; padding: 1rem; background: linear-gradient(45deg, #00f5ff, #ff00ff);
      border: none; border-radius: .75rem; color: #fff; font-weight: 600; font-size: 1.1rem;
      cursor: pointer; transition: .3s; box-shadow: 0 4px 15px rgba(0,255,255,.3); margin-top: 1rem; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,255,255,.5); }

    .link-btn { background: none; border: none; color: #00f5ff; cursor: pointer;
      margin-top: 1rem; display: block; text-decoration: underline; font-size: .95rem; text-align: center; }
    .link-btn:hover { color: #0ff; text-shadow: 0 0 8px #0ff; }

    .message { margin-top: 1rem; padding: .6rem 1rem; border-radius: .5rem; text-align: center; font-size: .9rem; }
    .msg-error { background: rgba(255,0,0,.3); color: #ff7777; }
    .msg-success { background: rgba(0,255,0,.3); color: #77ff77; }
  </style>
</head>
<body>
  <div class="map-bg"></div>

  <!-- TELA DE LOGIN -->
  <div class="container" id="login-container">
    <div class="logo-container">
      <img src="Mozimagem1.jpg" alt="Mapa de Moçambique">
      <div class="logo">Eyes Open MZ</div>
      <div class="tagline">Entre na sua conta</div>
    </div>

    <div class="box">
      <div class="input-group">
        <i class="fas fa-user"></i>
        <input type="text" id="login-username" placeholder="Nome do usuário (nickname)" />
      </div>
      <div class="input-group">
        <i class="fas fa-phone"></i>
        <input type="text" id="login-phone" placeholder="Número (+258 ou 9 dígitos)" />
      </div>
      <div class="input-group">
        <i class="fas fa-lock"></i>
        <input type="password" id="login-pass" placeholder="Senha" />
      </div>
      <button class="btn" onclick="confirmLogin()">Entrar</button>
      <button class="link-btn" onclick="goToRegister()">Criar conta nova</button>
      <div class="message msg-error" id="login-msg"></div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'eyesopenmz_users_v2';
    const VALID_PREFIXES = new Set(['82', '83', '84', '85', '86', '87']);

    function simpleHash(password) {
      let hash = 0;
      for (let i = 0; i < password.length; i++) {
        const char = password.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      return Math.abs(hash).toString(16);
    }

    function normalizeAndValidatePhone(input) {
      let phone = input.trim().replace(/\s+/g, '');
      if (phone.startsWith('+258')) {
        phone = phone.slice(4);
      }
      if (!/^\d{9}$/.test(phone)) {
        return { valid: false, error: 'Digite 9 dígitos (ex: 870755639)' };
      }
      const prefix = phone.slice(0, 2);
      if (!VALID_PREFIXES.has(prefix)) {
        return { valid: false, error: 'Prefixo inválido. Use 82–87' };
      }
      return { valid: true, normalized: '+258' + phone };
    }

    function showMessage(el, text, type) {
      el.textContent = text;
      el.className = `message msg-${type}`;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 4000);
    }

    function confirmLogin() {
      const username = document.getElementById('login-username').value.trim();
      const rawPhone = document.getElementById('login-phone').value.trim();
      const pass = document.getElementById('login-pass').value;
      const msg = document.getElementById('login-msg');

      if (!username || !rawPhone || !pass) return showMessage(msg, 'Preencha todos os campos', 'error');

      const phoneCheck = normalizeAndValidatePhone(rawPhone);
      if (!phoneCheck.valid) return showMessage(msg, phoneCheck.error, 'error');

      const users = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      const hashedPass = simpleHash(pass);
      const user = users.find(u => u.nickname.toLowerCase() === username.toLowerCase() && 
                                   u.phone === phoneCheck.normalized && 
                                   u.password === hashedPass);

      if (!user) {
        const phoneExists = users.some(u => u.phone === phoneCheck.normalized);
        if (!phoneExists) {
          return showMessage(msg, 'Este número não está registado', 'error');
        }
        return showMessage(msg, 'Dados incompatíveis. Verifique nome, número ou senha', 'error');
      }

      localStorage.setItem('currentUser', JSON.stringify(user));
      showMessage(msg, 'Login bem-sucedido! Redirecionando...', 'success');
      setTimeout(() => window.location.href = 'perfil.html', 2000);
    }

    function goToRegister() { window.location.href = 'registar.html'; }
  </script>
</body>
</html>